<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
	<title>6.1儿童节相册</title>
	<style type="text/css">
	body,ol,ul,h1,h2,h3,h4,h5,h6,p,th,td,dl,dd,form,fieldset,legend,input,textarea,select{margin:0;padding:0} 
	input[type="button"], input[type="submit"], input[type="reset"],select {-webkit-appearance: none;}
	textarea {  -webkit-appearance: none;} 
	body{
		margin: 0;
		padding: 0;
		background:#ffffe4; color:#828282;
	}
	h1, h2{
		font-weight: normal;
	}
	img{
		width:100%;
		height:100%;
	}
	.top,.photo{
		display: block;
	}
.photoBox{background:#fff; border-bottom:solid 1px #ffc3b9; border-top:solid 1px #ffc3b9;
width:90%; padding:5%;}	
.photoBox span{display:block;width:93px;max-height:93px;margin-right:2px;margin-bottom:2px;overflow:hidden;float:left;}
.photoBox span img{border:solid 1px #e5e5e5;box-sizing:border-box;display:block;}
	.camera{
		width:25%;
	    margin:5px auto;	
	    clear: both;
	}
	#cancelImg{
		width:93px;
		height:93px;
		float:left;
	}
	#cancelImg img{
		width:73px;
		height:63px;
		margin:10px 0 0 10px;
	}
	textarea{
	width: 90%;
    margin-left: 2.5%;
    border: none;
    color: #828282;
    font-size: 18px;
    border: 1px solid #ffc3ba;
    border-radius: 5px;
    padding: 2%;
    background: #fff;
		float:left;
	display:block;
	}
	.buttonDiv{
 background:#64d9ce; color:#fff; font-size:18px; text-align:center;  border-radius:5px; width:95%; border:none; padding:8px 0px; margin-left:2.5%; margin-top:10px;}
	.Color1{background:#FB9E8F;}
	.Color2{background:#74DDD3;}
	.description{
		margin-top:30px;
		font-size:.7em;
		padding:.5em 1.2em .6em 1.3em;
		line-height:1.7em;
		color:#A1A3A4;
	}
	.description strong{color:#FA9383;font-size:1.2em;}
	/*遮罩层*/
	.container{
		position:fixed;
		top:0;
		left: 0;
		width: 100%;
		height:100%;
		z-index: 100;
		background: rgba(0, 0, 0,0.8);
	}
	.popupBox{
		position: fixed;
		left:5%;
		top:20px;
		z-index:1000;
		width:90%;
		margin: 0 auto;
		background: #fef3eb;
		padding-bottom:1em;
	}
	.popupBox select{
		display: block;
		width: 92%;
		margin: 20px auto;
		padding:3%;
		border: 2px #ffc3b9 solid;
		border-radius: 5px;
		color: #ababab;
		background:#fff url(../addons/member/template/mobile/static/activity/20160601/arrow.png) 97% center no-repeat;
		background-size:20px 20px;
	}
	.popupBox input[type='radio']{border:1px solid #fb9e8f;height:14px;width:14px;-webkit-transform:translate(0,-1px);position: relative;}
	.popupBox input:checked{background:#fb9e8f}
	.popupBox h1{
		color: #fb9e8f;
		font-size: 16px;
		text-align: center;
		padding:18px 0 0;
	}
	.popupBox h2{
		text-align: center;
		font-size: 14px;
		padding:10px 0 15px;
	}
	.sex{
		overflow: hidden;
	}
	.typeChoose{float: left; margin-top:20px; margin-left: 10%;margin-right: 5px;}
	.buttonDiv2{
		text-align:center;
		line-height:34px;
		width:30%;
		margin-top:10px;	
		float: left;
		font-size:1em;
		height:34px;
		border:0;
		border-radius:5px;
		color:#fff;
	}
	.sex img{
		float: left;
		margin-left:13.3%;
		width: 30%;
	}
	.popupBox p{
		width: 90%;
		margin: 0 0 0 8%;
		overflow: hidden;
		font-size:14px;
	} 
	.popupBox p label{padding-right:.6em;}
	.popupBox p img{
		width: 18px;
		height: 18px;
	}
	.closeBtn{
		float: right;
		width:22px;
		height: 18px; 
	}
	.selected{
		background:#fff;
		border:2px solid  #efefef;
		width:86%;
		margin-left:5%;
		border-radius:5px;
		padding:2%;
		font-size:.8em;
		line-height:1.6em;
		margin-top:.5em;
		color:#888
	}
.txt{
	float:left;
	display:block;
	width: 90%;
	font-size: 16px;
    margin-left: 2.5%;
    border: none;
    color: #828282;
    font-size: 18px;
    border: 1px solid #ffc3ba;
    border-radius: 5px;
    padding: 2%;
    background: #fff;
	margin-top:10px;
	}
.txt input{ font-size:15px; color: #ababab; border:none; width:65%;}	
	em{ font-style:normal; font-size:0.7em; color: #ababab; margin-left:5%; width:84%;}	
	.checked{border:2px solid  #ffc3b9;}
	#mask{display:none;}
	#photoBox .camera img{ border:none}
	#photoBox img{ }
.tips{font-size:.8em;display:block;text-align:center;padding:.3em 0;clear:both;height:3em;}
.title{ font-size:1.4em; text-align:center; width:100%; color:#fb8573; background:url(bg1.jpg) no-repeat bottom  right;} 
.title1{ background:url(../addons/member/template/mobile/static/activity/20160601/bg1.png) no-repeat bottom  right; background-size:20%; line-height:60px;height:60px;} 
.title2{ background:url(../addons/member/template/mobile/static/activity/20160601/bg2.png) no-repeat bottom  left; background-size:20%; height:60px; line-height:60px; margin-top:10px;}
	
	</style>
</head>
<body>
	<!--主界面-->
		<img class="top" src="../addons/member/template/mobile/static/activity/20160601/top.png">
<h4 class="title title1">上传照片制作相册</h4>

		<div class="photoBox" id="photoBox">
        	<span id="sfilename1">
            	
            </span>	
            <span id="sfilename2">
            	
            </span>	
            <span id="sfilename3">
            	
            </span>	
            <span id="sfilename4">
            	
            </span>	
            <span id="sfilename5">
            	
            </span>	
            <span id="sfilename6">
            	
            </span>	
            <span id="sfilename7">
            	
            </span>	
            <span id="sfilename8">
            	
            </span>	
            <span id="sfilename9">
            	
            </span>		
            <div id="cancelImg" style="display:none;">
            	<img src="../addons/member/template/mobile/static/activity/20160601/cancelphoto.png" id="cancelphoto">
            </div>
            <div style="clear:both"></div>	
			<div class="camera" id="addImg">
				<img src="../addons/member/template/mobile/static/activity/20160601/camera.png" id="uploadphoto">
			</div>
            <div class="tips">最多可上传9张照片</div>
		</div>
        <h4 class="title title2">在下框写出自己的寄语</h4>
		<form action="" method="post">
			<textarea placeholder="写出自己的寄语！" rows="3" cols="30"  id="desc" name="desc">{$descArr[$tempId]}</textarea>
            <div class="txt">宝宝姓名：<input type="text" name="name" id="name" value="输入宝宝姓名" onclick="this.value=''" onBlur="if(this.value == ''){this.value='填写宝宝姓名'; }" value="填写宝宝姓名" > </div></div>
            <div class="txt">联系电话：<input type="text" name="mobile" id="mobile" value="正确填写 便于获奖通知" onclick="this.value=''" onBlur="if(this.value == ''){this.value='正确填写 便于获奖通知'; }" value="正确填写 便于获奖通知"   ></div>

            <input type="hidden" id="filename1" name="filename1" value="">
            <input type="hidden" id="filename2" name="filename2" value="">
            <input type="hidden" id="filename3" name="filename3" value="">
            <input type="hidden" id="filename4" name="filename4" value="">
            <input type="hidden" id="filename5" name="filename5" value="">
            <input type="hidden" id="filename6" name="filename6" value="">
            <input type="hidden" id="filename7" name="filename7" value="">
            <input type="hidden" id="filename8" name="filename8" value="">
            <input type="hidden" id="filename9" name="filename9" value="">
            <input type="hidden" id="num" name="num" value="1">
			<!--<input type="button" class="buttonDiv Color1" id="btn1" value="点我，帮你写情话" />-->
			<input type="button" class="buttonDiv Color2" id="btn2" value="上传，并选择相册模版" />
		</form>
		<div class="description">
			<strong>活动说明</strong>
			<p>* 上传照片，写下寄语，就能生成有趣的六一电子相册！<br/>
            * 相册生成后可参与投票，活动结束后按照票数进行奖励，票数前三名可获得糖猫智能手表（价值600元），第四至第十名可获16G卡通U盘（价值59元），另选出最具创意照片3-5名，可获博朗欧乐B儿童电动牙刷（价值150元）；
<br>
            * 本活动每人仅限参与一次，为保公平禁止刷票，一经发现立即取消参与资格；<br>
* 获奖顾客将在活动结束后2天内收到电话通知，获奖名单随后将于公众号公示。<br>
* 活动时间：2016.5.28-2016.6.1<br>
            
            </p>
		</div>
		

<script type="application/javascript" src="../addons/member/template/mobile/static/js/zepto.min.js" ></script>
<script type="application/javascript" src="../addons/member/template/mobile/static/js/touch-0.2.14.min.js"></script>
<script type="application/javascript" src="../addons/member/template/mobile/static/js/layer.m/layer.m.js"></script>
<script type="application/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">
	function changeDesc(){		
		var status = $("#attribute:checked").val();
		var xz = $("#xz").val();
		$.post("{php echo $this->createMobileUrl('520DayDesc','',true)}",{"status":status,"xz":xz},function(msg){
			if(msg.status){
				$("#demoDesc").val(msg.desc);
				$("#showDemo").html(msg.desc);
				$("#desc").val(msg.desc);
			}
		},'json');
	}
	$("#cancelphoto").click(function(){
		var num = $("#num").val();
		temp = num -1;
		$("#filename"+temp).val("");
		$("#sfilename"+temp).html("");	
		$("#sfilename"+temp).css('height','0');
		num --;
		if(num > 1){
			$("#cancelImg")	.show();
			$("#addImg").show();	
		}else{
			$("#cancelImg")	.hide();
		}
		if(num < 9){
			$("#addImg").show();		
		}
		$("#num").val(num);
	});
	function setDesc(){	
		document.querySelector('#mask').style.display = 'none';
	}
      
	   $('#btn2').click(function(){	
	   		var act_id = {$act_id};	   
            var desc = $('#desc').val();
			var name = $("#name").val();
			var mobile = $("#mobile").val();
			var filename1 = $("#filename1").val();
			var filename2 = $("#filename2").val();
			var filename3 = $("#filename3").val();
			var filename4 = $("#filename4").val();
			var filename5 = $("#filename5").val();
			var filename6 = $("#filename6").val();
			var filename7 = $("#filename7").val();
			var filename8 = $("#filename8").val();
			var filename9 = $("#filename9").val();
            if(desc && act_id && name && mobile && filename1){
				
                /*验证通过保存数据，跳转*/
                $.post("{php echo $this->createMobileUrl('ActivitySave','',true)}",{"desc":desc,"name":name,"mobile":mobile,"filename1":filename1,"filename2":filename2,"filename3":filename3,"filename4":filename4,"filename5":filename5,"filename6":filename6,"filename7":filename7,"filename8":filename8,"filename9":filename9,"openid":"{$_W['openid']}","act_id":act_id},function(msg){
					if(msg.status){
                		location.href = 'http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=ActivityTemp&m=member&id='+msg.id+"&act_id="+msg.act_id;
					}else{
						layer.open({
               				content: '发送失败请稍后再试！',
               				btn: ['OK']
               			});	
					}
                },'json');

            }else{
               layer.open({
               	content: '请将内容填写完整！',
               	btn: ['OK']
               });
            }
        });



    wx.config({
        debug: false,
        appId: "{$_W['account']['jssdkconfig']['appId']}",
        timestamp: "{$_W['account']['jssdkconfig']['timestamp']}",
        nonceStr: "{$_W['account']['jssdkconfig']['nonceStr']}",
        signature: "{$_W['account']['jssdkconfig']['signature']}",
        jsApiList: [
            'checkJsApi',               // 判断当前客户端版本是否支持指定JS接口
            'onMenuShareTimeline',      // 分享到朋友圈
            'onMenuShareAppMessage',    // 分享给朋友
            'onMenuShareQQ',            // 分享到QQ
            'onMenuShareWeibo',         // 分享到腾讯微博
            'hideMenuItems',            // 批量隐藏功能按钮接口
            'showMenuItems',            // 批量显示功能按钮接口
            'hideAllNonBaseMenuItem',   // 隐藏所有非基础按钮接口
            'showAllNonBaseMenuItem',   // 显示所有功能按钮接口
            'getNetworkType',           // 获取网络状态接口
            'openLocation',             // 使用微信内置地图查看位置接口
            'getLocation',              // 获取地理位置接口
            'hideOptionMenu',           // 批量隐藏功能按钮接口
            'showOptionMenu',           // 批量显示功能按钮接口
            'closeWindow',              // 关闭当前网页窗口接口
            'addCard',                  // 批量添加卡券接口
            'chooseCard',               // 调起适用于门店的卡券列表并获取用户选择列表
            'openCard',                 // 查看微信卡包中的卡券接口
			'chooseImage',
            'previewImage',
            'uploadImage',
            'downloadImage'
        ]
    });

    wx.ready(function(){
         // 分享到朋友券
         wx.onMenuShareTimeline({
            title: "{$shareData['title']}", // 分享标题
            link: "http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=ActivityIndex&m=member&act_id={$act_id}", // 分享链接
            imgUrl: 'http://wx.cnsaga.com/addons/member/template/mobile/static/activity/{$act_id}/share2.png', // 分享图标
            success: function (res) {

            }
        });

        // 分享给朋友
        wx.onMenuShareAppMessage({
            title: "{$shareData['title']}", // 分享标题
            desc:  "{$shareData['desc']}", // 分享描述
            link: "http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=ActivityIndex&m=member&act_id={$act_id}", // 分享链接
            imgUrl: 'http://wx.cnsaga.com/addons/member/template/mobile/static/activity/{$act_id}/share2.png', // 分享图标
            success: function (res) {

            }
        });
		
		//上传照片
		$('#uploadphoto').click(function(){
			wx.chooseImage({
    			count: 1, // 默认9
    			success: function (res) {
        			// 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
					var num = $("#num").val();
					if(num >= 9){
						$("#addImg").hide();	
					}else{
						$("#addImg").show();		
					}
					$("#sfilename"+num).html("<img src='"+res.localIds+"'/>");
					$("#sfilename"+num).css('height','93px');
					uploadPhoto(res.localIds,num);
    			}
			});
		});
		
		 function uploadPhoto(localId,num){
			var act_id = {$act_id};
            wx.uploadImage({
                localId:localId.toString(),
                isShowProcess: 1,
                success:function(res){
                    var serverId = res.serverId;
                    $.post("{php echo $this->createMobileUrl('uploadimg','',true)}",{"serverId":serverId,"act_id":act_id},function(msg){
						
                        if (msg.status) {							
                            $("#filename"+num).val(msg.filename);
							num++;
							if(num > 1){
								$("#cancelImg")	.show();
							}else{
								$("#cancelImg")	.hide();
							}
							$("#num").val(num);
                        } else {
                            layer.open({
               				 content: '上传图片失败！',
               			 	 btn: ['OK']
               				});
                        }
                    },'json');
                },
                fail:function(res){
                    alert('上传失败，请稍后再试');
                }
            })
        }	
    });

</script>
</body>
</html>