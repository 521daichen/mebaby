<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"  content=" initial-scale=1, minimum-scale=1,maximum-scale=1, width=device-width,user-scalable=0">
<meta content="telephone=no" name="format-detection">
<title>感恩母亲</title>
<style type="text/css">
*{margin: 0;padding: 0;list-style: none;}
body{font-size:18px;}
body, h1, h2, h3, h4, h5, h6, hr, p, blockquote, dl, dt, dd, ul, ol, li, form, fieldset, legend, button, input, textarea,th, td{margin: 0; padding: 0;}
ul, ol { list-style: none; }
i,em{font-style:normal}
a{ text-decoration:none;}
input[type="button"], input[type="submit"], input[type="reset"],select {
-webkit-appearance: none;
}
body{ background:#fcf8f5; color:#828282;}
header img{ width:100%;}
.content{ background:#fff; border-bottom:solid 1px #ececec; border-top:solid 1px #ececec;
width:90%; padding:5%;}
.photo li{  width:80px; margin-left:1%; margin-right:1%;border:dashed 1px #c2c2c2; color:#e2e2e2; text-align:center;height:80px;line-height:80px;background-repeat:no-repeat;-webkit-background-size:cover;display:block;overflow:hidden;}
.message .desc{width:98%; padding:1%; border:none; color:#CCC; font-size:18px;}
.kk{width:95%; border:1px solid #ffc3ba; border-radius:5px;  padding:2%; background:#fff;}
.name,.telephone,.address{ border:none;color:#CCC; font-size:18px; }
.name,.telephone{ margin-left:5px; }
.btn{ background:#fb9e90; color:#fff; font-size:18px; text-align:center;  border-radius:5px; width:100%; border:none; padding:8px 0px;}
.address{width:95%; border:1px solid #ffc3ba; border-radius:5px;  padding:2%; background:#fff;}
.name,.telephone { margin-top:-3px; }
.content span{ width:93%; border:1px solid #ffc3ba; border-radius:5px; padding:3%; float:left; margin-bottom:5px;}
footer{width:90%; padding:5%; font-size:16px;}
footer h4{ color:#fb9e90; margin-bottom:5px;}
</style>
</head>

<body>
<header><img src="../addons/member/template/mobile/static/mothersDay/banner.jpg"></header>
<form action="" method="post" name="form1">
<div class="content message">
<textarea rows="3" cols="30" name="title" id="title" class="address" onFocus="this.value='';this.style.color='black';" onBlur="if(this.value==''){this.value='照片标题:'; this.style.color='#CCC'}"  style="margin-top:10px;">照片标题:</textarea>

<div class="kk">
<textarea rows="4" cols="30" name="desc" id="desc" onFocus="this.value='';this.style.color='black';" onBlur="if(this.value==''){this.value='上传照片并说说照片背后的故事及对妈妈说的话…'; this.style.color='#CCC'}" class="desc">上传照片并说说照片背后的故事及对妈妈说的话…</textarea>
<ul class="photo">
<li id="showPhoto"><img src="../addons/member/template/mobile/static/mothersDay/ico.jpg" style="width:90%;"></li>
</ul>
</div>
</div>
<div class="content" style="margin-top:10px;">
<span>姓名:<input type="text" name="name" id="name" class="name" onFocus="this.value='';this.style.color='black';"></span>
<span>电话:<input type="number" name="mobile" id="mobile" class="telephone" onFocus="this.value='';this.style.color='black';"></span>
<textarea rows="3" cols="30" name="address" id="address" class="address" onFocus="this.value='';this.style.color='black';" onBlur="if(this.value==''){this.value='地址:正确填写地址及电话，便于审核通过后邮寄卡片及照片。'; this.style.color='#CCC'}">地址:正确填写地址及电话，便于审核通过后邮寄卡片及照片。</textarea>
<input type="hidden" name="filename" id="filename" value="">
<input type="button" value="提 交" class="btn" id="button" name="button">
</div>
</form>
<footer>
<h4>活动说明</h4>
<table border="0" cellpadding="0" cellspacing="0" width="100%" >
	<tr height="30">
    	<td align="center" width="20px" valign="top" style="padding:10px;">*</td>
        <td align="left" style="padding:5px;">每人限投1稿，文字控制在100字以内。</td>
    </tr>
    <tr height="30">
    	<td align="center" valign="top" style="padding:10px;">*</td>
        <td align="left"  style="padding:5px;">上传妈妈照片，并附上一段文字说明，正确填写联系资料后提交，我们将从中选出30名参与奖和10名优秀奖。</td>
    </tr>
    <tr height="30">
    	<td align="center" valign="top" style="padding:10px;">*</td>
        <td align="left"  style="padding:5px;">参与奖可获得赛格国际购物中心送出的定制卡片，并将您上传的照片及卡片邮寄到您填写的地址。</td>
    </tr>
    <tr height="30">
    	<td align="center" valign="top" style="padding:10px;">*</td>
        <td align="left"  style="padding:5px;">优秀奖在参与奖基础上可再获得赛格国际购物中心/赛格电脑商城两店通用100元现金卡购物一张。</td>
    </tr>
    <tr height="30">
    	<td align="center" valign="top" style="padding:10px;">*</td>
        <td align="left"  style="padding:5px;">征集时间：2016.5.5-2016.5.10</td>
    </tr>
</table>
</footer>


<script type="application/javascript" src="../addons/member/template/mobile/static/js/zepto.min.js" ></script>
<script type="application/javascript" src="../addons/member/template/mobile/static/js/touch-0.2.14.min.js"></script>
<script type="application/javascript" src="../addons/member/template/mobile/static/js/layer.m/layer.m.js"></script>
<script type="application/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">

      
	   $('#button').click(function(){
            var desc = $('#desc').val();
			var title = $('#title').val();
			var mobile = $('#mobile').val();
			var name = $('#name').val();
			var address = $('#address').val();
			var filename = $("#filename").val();
            if(desc && title && mobile && name && address && filename){
				layer.open({
					content: '本活动每人只能参与一次，请确认您填写的信息无误后点击确认按钮！',
               		btn: ['确认']
				});
                /*验证通过保存数据，跳转*/
                $.post("{php echo $this->createMobileUrl('savemother','',true)}",{"desc":desc,"title":title,"mobile":mobile,"name":name,"address":address,"filename":filename,"openid":"{$_W['openid']}"},function(msg){
					if(msg.status){
                		location.href = 'http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=showMother&m=member&id='+msg.id;
					}else{
						layer.open({
               				content: '发送失败请稍后再试！',
               				btn: ['OK']
               			});	
					}
                },'json');

            }else{
               layer.open({
               	content: '请将内容填写完整！',
               	btn: ['OK']
               });
            }
        });



    wx.config({
        debug: false,
        appId: "{$_W['account']['jssdkconfig']['appId']}",
        timestamp: "{$_W['account']['jssdkconfig']['timestamp']}",
        nonceStr: "{$_W['account']['jssdkconfig']['nonceStr']}",
        signature: "{$_W['account']['jssdkconfig']['signature']}",
        jsApiList: [
            'checkJsApi',               // 判断当前客户端版本是否支持指定JS接口
            'onMenuShareTimeline',      // 分享到朋友圈
            'onMenuShareAppMessage',    // 分享给朋友
            'onMenuShareQQ',            // 分享到QQ
            'onMenuShareWeibo',         // 分享到腾讯微博
            'hideMenuItems',            // 批量隐藏功能按钮接口
            'showMenuItems',            // 批量显示功能按钮接口
            'hideAllNonBaseMenuItem',   // 隐藏所有非基础按钮接口
            'showAllNonBaseMenuItem',   // 显示所有功能按钮接口
            'getNetworkType',           // 获取网络状态接口
            'openLocation',             // 使用微信内置地图查看位置接口
            'getLocation',              // 获取地理位置接口
            'hideOptionMenu',           // 批量隐藏功能按钮接口
            'showOptionMenu',           // 批量显示功能按钮接口
            'closeWindow',              // 关闭当前网页窗口接口
            'addCard',                  // 批量添加卡券接口
            'chooseCard',               // 调起适用于门店的卡券列表并获取用户选择列表
            'openCard',                 // 查看微信卡包中的卡券接口
			'chooseImage',
            'previewImage',
            'uploadImage',
            'downloadImage'
        ]
    });

    wx.ready(function(){
         // 分享到朋友券
        wx.onMenuShareTimeline({
            title: '妈，咱俩一起拍张照吧', // 分享标题
            link: 'http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=MothersDay&m=member', // 分享链接
            imgUrl: 'http://wx.cnsaga.com/addons/member/template/mobile/static/mothersDay/share.jpg', // 分享图标
            success: function (res) {

            }
        });

        // 分享给朋友
        wx.onMenuShareAppMessage({
            title: '妈，咱俩一起拍张照吧', // 分享标题
            desc: '上传和妈妈的合影，并说出照片背后的故事，即可制作成为祝福贺卡，还有机会获得赛格国际100元购物卡（两店通用）', // 分享描述
            link: 'http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=MothersDay&m=member', // 分享链接
            imgUrl: 'http://wx.cnsaga.com/addons/member/template/mobile/static/mothersDay/share.jpg', // 分享图标
            success: function (res) {

            }
        });
		
		//上传照片
		$('.photo').click(function(){
			wx.chooseImage({
    			count: 1, // 默认9
    			success: function (res) {
        			// 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
					$("#showPhoto").html("<img src='"+res.localIds+"'/>");
					var showPhoto = $("#showPhoto img");
					if(showPhoto.width()>showPhoto.height()){
						$("#showPhoto img").css({'width':'100%'});
						}else{
						$("#showPhoto img").css({'height':'100%'});	
						}
					uploadPhoto(res.localIds);
    			}
			});
		});
		
		 function uploadPhoto(localId){
            wx.uploadImage({
                localId:localId.toString(),
                isShowProcess: 1,
                success:function(res){
                    var serverId = res.serverId;
                    $.post("{php echo $this->createMobileUrl('uploadimg','',true)}",{"serverId":serverId},function(msg){
						
                        if (msg.status) {							
                            $("#filename").val(msg.filename);
                        } else {
                            layer.open({
               				 content: '上传图片失败！',
               			 	 btn: ['OK']
               				});
                        }
                    },'json');
                },
                fail:function(res){
                    alert('上传失败，请稍后再试');
                }
            })
        }
		
		
    });

</script>
</body>
</html>
