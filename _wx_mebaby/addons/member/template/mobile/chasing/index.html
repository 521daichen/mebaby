<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,minimal-ui" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="telephone=no" name="format-detection">
<title>赛格国际购物中心七夕相亲活动</title>
<link rel="stylesheet" type="text/css" href="../../addons/member/template/mobile/static/chasing/images/indexstyle.css" />
<link rel="stylesheet" type="text/css" href="../../addons/member/template/mobile/static/chasing/css/desl.css" />
<link rel="stylesheet" type="text/css" href="../../addons/member/template/mobile/static/chasing/css/animate.css" />
<link rel="stylesheet" type="text/css" href="../../addons/member/template/mobile/static/chasing/css/zepto.mdatetimer.css">
<script type="text/javascript" src="../../addons/member/template/mobile/static/chasing/js/zepto.min.js"></script>
<script type="text/javascript" src="../../addons/member/template/mobile/static/chasing/js/zepto.mdatetimer.js"></script>
<style type="text/css" media="screen" id="test">
	.tips{width:100%;height:100%;background:rgba(0,0,0,0.8);position: fixed;}
	.tips img{width:300px;margin-top:20%;position: absolute;left:50%;margin-left:-150px;}
</style>
</head>
<!--资料提交页-->
<body class="bg">
<div class="tips" onclick="this.style.display='none';"><img src="../../addons/member/template/mobile/static/chasing/images/tips.png"></div>

<div class="top">
<img src="../../addons/member/template/mobile/static/chasing/images/logo.png" class="logo">
<div class="head" ><span class="tx" id="uploadphoto">+<br><em>请上传照片</em></span></div>
</div>
<form action=" " method="get" id="information">
<div class="information">
<h4>我的信息</h4>
<div class="information_list">

<ul>
<li><span>我的职业</span><input type="text" name="zy" id="zy" readonly   placeholder="选择你的职业"><em><img src="../../addons/member/template/mobile/static/chasing/images/jt.jpg"></em></li>
<li><span>我的爱好</span><input type="text" name="ah" id="ah" readonly  placeholder="选择你的爱好"><em><img src="../../addons/member/template/mobile/static/chasing/images/jt.jpg"></em></li>
<li><span>我的标签</span><input type="text" name="bq" id="bq" readonly   placeholder="选择你的标签"><em><img src="../../addons/member/template/mobile/static/chasing/images/jt.jpg"></em></li>
<li><textarea rows="3" cols="20" id="desc" name="desc" placeholder="脱单宣言"></textarea></li>
</ul>

</div>
</div>
<div class="information">
<h4>交友要求</h4>
<div class="information_list">

<ul>
<li><span style="color:#e30">您的性取向</span><input type="text" name="xb" id="xb" readonly placeholder="输入您的性取向"><em><img src="../../addons/member/template/mobile/static/chasing/images/jt.jpg"></em></li>
<li class="m"><span>对方年龄</span><input type="text" name="mnl" id="mnl" readonly  placeholder="对女生年龄的要求"><em><img src="../../addons/member/template/mobile/static/chasing/images/jt.jpg"></em></li>
<li class="m"><span>对方类型</span><input type="text" name="mlx" id="mlx" readonly   placeholder="喜欢的女生的类型"><em><img src="../../addons/member/template/mobile/static/chasing/images/jt.jpg"></em></li>
<li class="w"><span>对方年龄</span><input type="text" name="wnl" id="wnl" readonly  placeholder="对男生年龄的要求"><em><img src="../../addons/member/template/mobile/static/chasing/images/jt.jpg"></em></li>
<li class="w"><span>对方类型</span><input type="text" name="wlx" id="wlx" readonly   placeholder="喜欢的男生的类型"><em><img src="../../addons/member/template/mobile/static/chasing/images/jt.jpg"></em></li>
</ul>

</div>
</div>
<div class="information">
<h4>隐私信息</h4>
<div class="information_list">

<ul>
<li><span>姓名</span><input type="text" name="nickname" id="nickname" placeholder="点此输入姓名" ></li>
<li><span>生日</span><input type="text" name="birthday" id="birthday" placeholder="点此选择生日" value="1998-07-01" readonly ></li>
<li><span>联系方式</span><input type="text" id="mobile" name="mobile" placeholder="填写你的电话" ></li>
</ul>
</div>
<input type="hidden" name="age" id="age" value="" />
<input type="hidden" name="symbol_star_id" id="symbol_star_id" value="" />
<input type="hidden" name="desc_img" id="desc_img" value="" />
<input type="button" value="保存信息" class="btn" id="btn" />
</div>
</form>
<script type="text/javascript" src="../../addons/member/template/mobile/static/chasing/js/autoScale.js" ></script>
<script type="text/javascript" src="../../addons/member/template/mobile/static/chasing/js/desl.js"></script>
<script type="text/javascript">
 
	Zepto(function($){
		var bd = $("#birthday").val();
		var age = jsGetAge(bd);
		$("#age").val(age);
		var xz = jsGetXz(bd);
		$("#symbol_star_id").val(xz);
		$('#btn').click(function(){	
			var act_id = 20160809;
	   		var zy = $("#zy").val();
			var ah = $("#ah").val();
			var bq = $("#bq").val();
            var desc = $('#desc').val();
			
			var xb = $("#xb").val();
			var mnl = $("#mnl").val();
			var mlx = $("#mlx").val();
			var wnl = $("#wnl").val();
			var wlx = $("#wlx").val();
			
			var nickname = $("#nickname").val();
			var mobile = $("#mobile").val();
			var birthday = $("#birthday").val();
			var age = $("#age").val();
			var symbol_star_id = $("#symbol_star_id").val();
			var desc_img = $("#desc_img").val();
			
            if(zy && ah && bq && desc && xb && (mnl || wnl) && (mlx || wlx) && nickname && mobile && birthday && age && symbol_star_id && desc_img ){
				
                /*验证通过保存数据，跳转*/
                $.post("{php echo $this->createMobileUrl('ActivitySave','',true)}",{"zy":zy,"ah":ah,"bq":bq,"desc":desc,"xb":xb,"mnl":mnl,"mlx":mlx,"wnl":wnl,"wlx":wlx,"nickname":nickname,"mobile":mobile,"birthday":birthday,"age":age,"symbol_star_id":symbol_star_id,"desc_img":desc_img,"mobile":mobile,"openid":"{$_W['openid']}","act_id":act_id},function(msg){
					if(msg.status){
                		location.href = 'http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=GetPersonal&m=member';
					}else{				
               			alert( '发送失败请稍后再试！');
					}
                },'json');

            }else{             
               	alert( '请将内容填写完整！');
            }
        });
		$('#birthday').mdatetimer({
			mode : 1, //时间选择器模式：1：年月日，2：年月日时分（24小时），3：年月日时分（12小时），4：年月日时分秒。默认：1
			format : 2, //时间格式化方式：1：2015年06月10日 17时30分46秒，2：2015-05-10  17:30:46。默认：2
			years : [1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998], //年份数组
			nowbtn : false, //是否显示现在按钮
			onOk : function(){
				var bd = $("#birthday").val();
				var age = jsGetAge(bd);
				$("#age").val(age);
				var xz = jsGetXz(bd);
				$("#symbol_star_id").val(xz);
				//alert('OK');
			},  //点击确定时添加额外的执行函数 默认null
			onCancel : function(){
				//alert('A');
			}, //点击取消时添加额外的执行函数 默认null
		});	

	   $("#zy").on("tap",function(){ 
			desl.getlist(4,0,1,'#zy','、');
	   });
	   $("#ah").on("tap",function(){ 
			desl.getlist(5,1,1,'#ah','、');
	   });
	   $("#bq").on("tap",function(){ 
			desl.getlist(6,1,0,'#bq','、');
	   });
	   $("#xb").on("tap",function(){ 
			desl.getlist(7,0,0,'#xb','、');
			setInterval(function(){
			if($("#xb").val()!== ""){
				if($("#xb").val() == "女"){
					$(".w").css("display","none");
					$(".m").css("display","block");
				}else{
					$(".m").css("display","none");
					$(".w").css("display","block");
				}
			}
			}, 1000);
	   });
	   $("#mnl").on("tap",function(){ 
			desl.getlist(2,0,0,'#mnl','、');
	   });
	   $("#mlx").on("tap",function(){ 
			desl.getlist(3,0,0,'#mlx','、');
	   });
	   $("#wnl").on("tap",function(){ 
			desl.getlist(0,0,0,'#wnl','、');
	   });
	   $("#wlx").on("tap",function(){ 
			desl.getlist(1,0,0,'#wlx','、');
	   });
	});
</script>
<script type="application/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript">
 wx.config({
        debug: false,
        appId: "{$_W['account']['jssdkconfig']['appId']}",
        timestamp: "{$_W['account']['jssdkconfig']['timestamp']}",
        nonceStr: "{$_W['account']['jssdkconfig']['nonceStr']}",
        signature: "{$_W['account']['jssdkconfig']['signature']}",
        jsApiList: [
            'checkJsApi',               // 判断当前客户端版本是否支持指定JS接口
            'onMenuShareTimeline',      // 分享到朋友圈
            'onMenuShareAppMessage',    // 分享给朋友
            'onMenuShareQQ',            // 分享到QQ
            'onMenuShareWeibo',         // 分享到腾讯微博
            'hideMenuItems',            // 批量隐藏功能按钮接口
            'showMenuItems',            // 批量显示功能按钮接口
            'hideAllNonBaseMenuItem',   // 隐藏所有非基础按钮接口
            'showAllNonBaseMenuItem',   // 显示所有功能按钮接口
            'getNetworkType',           // 获取网络状态接口
            'openLocation',             // 使用微信内置地图查看位置接口
            'getLocation',              // 获取地理位置接口
            'hideOptionMenu',           // 批量隐藏功能按钮接口
            'showOptionMenu',           // 批量显示功能按钮接口
            'closeWindow',              // 关闭当前网页窗口接口
            'addCard',                  // 批量添加卡券接口
            'chooseCard',               // 调起适用于门店的卡券列表并获取用户选择列表
            'openCard',                 // 查看微信卡包中的卡券接口
			'chooseImage',
            'previewImage',
            'uploadImage',
            'downloadImage'
        ]
    });

    wx.ready(function(){
         // 分享到朋友券
         wx.onMenuShareTimeline({
            title: "拯救单身汪手册 还有免费约会基金！ ", // 分享标题
            link: "http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=UploadProfile&m=member", // 分享链接
            imgUrl: 'http://wx.cnsaga.com/addons/member/template/mobile/static/chasing/images/share.jpg', // 分享图标
            success: function (res) {

            }
        });

        // 分享给朋友
        wx.onMenuShareAppMessage({
            title: "拯救单身汪手册 还有免费约会基金！ ", // 分享标题
            desc:  "七夕不愿做单身汪？狗粮太多无处可躲？什么时候才能遇见我的TA？七夕遇见你的另一半，就从这里开始……", // 分享描述
            link: "http://wx.cnsaga.com/app/index.php?i=4&c=entry&do=UploadProfile&m=member", // 分享链接
            imgUrl: 'http://wx.cnsaga.com/addons/member/template/mobile/static/chasing/images/share.jpg', // 分享图标
            success: function (res) {

            }
        });
		
		//上传照片
		$('#uploadphoto').click(function(){
			wx.chooseImage({
    			count: 1, // 默认9
    			success: function (res) {
        			// 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
					$("#uploadphoto").html("<img src='"+res.localIds+"'/>");
					$("#uploadphoto").css('height','93px');
					uploadPhoto(res.localIds);
    			}
			});
		});
		
		function uploadPhoto(localId){
			var act_id = 20160809;
            wx.uploadImage({
                localId:localId.toString(),
                isShowProcess: 1,
                success:function(res){
                    var serverId = res.serverId;					
                    $.post("{php echo $this->createMobileUrl('uploadimg','',true)}",{"serverId":serverId,"act_id":act_id},function(msg){
                        if (msg.status) {							
                            $("#desc_img").val(msg.filename);
                        } else {
                            layer.open({
               				 content: '上传图片失败！',
               			 	 btn: ['OK']
               				});
                        }
                    },'json');
                },
                fail:function(res){
                    alert('上传失败，请稍后再试');
                }
            })
        }	
    });
	/*根据出生日期算出年龄*/  
function jsGetAge(strBirthday){         
    var returnAge;  
    var strBirthdayArr=strBirthday.split("-");  
    var birthYear = strBirthdayArr[0];  
    var birthMonth = strBirthdayArr[1];  
    var birthDay = strBirthdayArr[2];  
      
    d = new Date();  
    var nowYear = d.getFullYear();  
    var nowMonth = d.getMonth() + 1;  
    var nowDay = d.getDate();  
      
    if(nowYear == birthYear){  
        returnAge = 0;//同年 则为0岁  
    }  
    else{  
        var ageDiff = nowYear - birthYear ; //年之差  
        if(ageDiff > 0){  
            if(nowMonth == birthMonth) {  
                var dayDiff = nowDay - birthDay;//日之差  
                if(dayDiff < 0)  
                {  
                    returnAge = ageDiff - 1;  
                }  
                else  
                {  
                    returnAge = ageDiff ;  
                }  
            }  
            else  
            {  
                var monthDiff = nowMonth - birthMonth;//月之差  
                if(monthDiff < 0)  
                {  
                    returnAge = ageDiff - 1;  
                }  
                else  
                {  
                    returnAge = ageDiff ;  
                }  
            }  
        }  
        else  
        {  
            returnAge = -1;//返回-1 表示出生日期输入错误 晚于今天  
        }  
    }
	return returnAge;//返回周岁年龄    
}  
function jsGetXz(strBirthday){
	var returnAge;  
    var strBirthdayArr=strBirthday.split("-");  
    var birthYear = strBirthdayArr[0];  
    var month = strBirthdayArr[1];  
    var date = strBirthdayArr[2];  
	if (month == 1 && date >=20 || month == 2 && date <=18) {value = "6";}
	if (month == 2 && date >=19 || month == 3 && date <=20) {value = "12";}
	if (month == 3 && date >=21 || month == 4 && date <=19) {value = "1";}
	if (month == 4 && date >=20 || month == 5 && date <=20) {value = "7";}
	if (month == 5 && date >=21 || month == 6 && date <=21) {value = "4";}
	if (month == 6 && date >=22 || month == 7 && date <=22) {value = "10";}
	if (month == 7 && date >=23 || month == 8 && date <=22) {value = "2";}
	if (month == 8 && date >=23 || month == 9 && date <=22) {value = "8";}
	if (month == 9 && date >=23 || month == 10 && date <=22) {value = "5";}
	if (month == 10 && date >=23 || month == 11 && date <=21) {value = "11";}
	if (month == 11 && date >=22 || month == 12 && date <=21) {value = "3";}
	if (month == 12 && date >=22 || month == 1 && date <=19) {value = "9";}
	return value;
}
</script>
</body>
</html>
